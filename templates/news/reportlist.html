{% extends 'base.html' %}

{% block title %}
  Quota Reform Protest Archive
{% endblock %}

{% block content %}
  {% load bleach_tags %}
  <div class="container mx-auto md:w-4/5 mt-5">
    {% if object_list %}
      <div class="grid grid-cols-1 gap-4">
        {% for news in object_list %}
          <div class="card bg-base-100 shadow-md">
            <div class="grid grid-cols-1 md:grid-cols-2">
              <!-- Image Column -->
              {% if news.image %}
                <figure class="flex items-center justify-center p-4">
                  <img src="{{ news.image }}" class="object-cover h-48 w-full md:w-full" alt="{{ news.title }}" />
                </figure>
              {% endif %}
              <!-- Text Column -->
              <div class="p-6 flex flex-col justify-between">
                <h3 class="text-xl font-semibold mb-2">{{ news.title }}</h3>
                <p class="mb-4 text-sm">
                  {{ news.content|bleach|slice:":300" }}{% if news.content|length > 300 %}...{% endif %}
                </p>
                <div class="flex justify-between items-center">
                  <a href="{% url 'report-detail' news.id %}" class="btn btn-primary btn-sm" target="_blank" rel="noopener noreferrer">Read Full Report</a>
                  {% if news.archive_link %}
                    <a href="{{ news.archive_link }}" class="btn btn-secondary btn-sm" target="_blank" rel="noopener noreferrer">View Archived</a>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      <!-- Pagination Controls -->
      <div class="mt-6 flex justify-center">
        <div class="join">
          <!-- Previous page button -->
          {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}" class="join-item btn">Previous</a>
          {% else %}
            <span class="join-item btn btn-disabled">Previous</span>
          {% endif %}
      
          <!-- First page button -->
          {% if page_obj.number > 3 %}
            <a href="?page=1" class="join-item btn">1</a>
          {% endif %}
      
          <!-- Second page button -->
          {% if page_obj.number > 4 %}
            <a href="?page=2" class="join-item btn">2</a>
          {% endif %}
      
          <!-- Ellipses before the current page range -->
          {% if page_obj.number > 5 %}
            <span class="join-item btn btn-disabled">...</span>
          {% endif %}
      
          <!-- Page number buttons -->
          {% for num in page_obj.paginator.page_range %}
            {% if num >= page_obj.number|add:'-2' and num <= page_obj.number|add:'2' %}
              {% if num == page_obj.number %}
                <span class="join-item btn btn-active">{{ num }}</span>
              {% else %}
                <a href="?page={{ num }}" class="join-item btn">{{ num }}</a>
              {% endif %}
            {% endif %}
          {% endfor %}
      
          <!-- Ellipses after the current page range -->
          {% if page_obj.number < page_obj.paginator.num_pages|add:'-3' %}
            <span class="join-item btn btn-disabled">...</span>
          {% endif %}
      
          <!-- Last page button -->
          {% if page_obj.number < page_obj.paginator.num_pages|add:'-1' %}
            <a href="?page={{ page_obj.paginator.num_pages }}" class="join-item btn">{{ page_obj.paginator.num_pages }}</a>
          {% endif %}
      
          <!-- Next page button -->
          {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}" class="join-item btn">Next</a>
          {% else %}
            <span class="join-item btn btn-disabled">Next</span>
          {% endif %}
        </div>
      </div>
    {% else %}
      <p class="text-center mt-5">No news available.</p>
    {% endif %}
  </div>
{% endblock %}
